---
import "../../public/Img/olvidocontraseña.png";
import "../../public/Img/image1.png";
import Botton from "../Components/BotonPrincipal.astro";
import Input from "../Components/Input.astro";
import Modal from "../Components/Modal.astro";
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actualizar Contraseña</title>
  <link rel="stylesheet" href="/path/to/your/styles.css"> <!-- Asegúrate de que la ruta sea correcta -->
</head>
<body>
    <div class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
          <h2 class="text-2xl font-bold text-gray-800 text-center">Actualizar Contraseña</h2>
          <form id="update-password-form" class="mt-6">
            <input type="hidden" id="token" />
            <input type="hidden" id="email" />

            <div class="mb-4">
              <label for="new-password" class="block text-gray-700 font-semibold">Nueva Contraseña</label>
              <input type="password" id="new-password" class="mt-2 px-3 py-2 border border-gray-300 rounded-lg w-full" required />
            </div>

            <div class="mb-4">
              <label for="confirm-password" class="block text-gray-700 font-semibold">Confirmar Contraseña</label>
              <input type="password" id="confirm-password" class="mt-2 px-3 py-2 border border-gray-300 rounded-lg w-full" required />
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 rounded-lg">Actualizar Contraseña</button>
            <p id="message" class="mt-4 text-center"></p>
          </form>
        </div>
      </div>
  <script>
   document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('update-password-form');
  const messageElement = document.getElementById('message');
  const tokenInput = document.getElementById('token');
  const emailInput = document.getElementById('email');
  const newPasswordInput = document.getElementById('new-password');
  const confirmPasswordInput = document.getElementById('confirm-password');

  // Extraer el token y el email de la URL
  const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get('token');
const email = urlParams.get('email');

  if (token && email) {
    tokenInput.value = token;
    emailInput.value = email;
  }

  if (form && messageElement && tokenInput && emailInput && newPasswordInput && confirmPasswordInput) {
    form.addEventListener('submit', async function(event) {
      event.preventDefault();

      const newPassword = newPasswordInput.value;
      const confirmPassword = confirmPasswordInput.value;

      if (newPassword !== confirmPassword) {
        messageElement.textContent = 'Las contraseñas no coinciden.';
        messageElement.classList.add('text-red-500');
        return;
      }

      try {
        const response = await fetch('http://localhost:4000/api/update-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token, email, newPassword })
        });

        const result = await response.json();

        if (response.ok) {
          messageElement.textContent = 'Contraseña actualizada exitosamente.';
          messageElement.classList.remove('text-red-500');
          messageElement.classList.add('text-green-500');
        } else {
          messageElement.textContent = result.error;
          messageElement.classList.add('text-red-500');
        }
      } catch (error) {
        messageElement.textContent = 'Error al actualizar la contraseña.';
        messageElement.classList.add('text-red-500');
      }
    });
  }
});
  </script>
</body>
</html>